<?xml version="1.0" encoding="utf-8" ?>
<data>
    <learn-tutorial-view>
        <section id="59" handle="tutorials">Tutorials</section>
        <entry id="36368" tutorial-steps="6">
            <audiences>
                <item handle="developers">Developers</item>
            </audiences>
            <author handle="nickdunn">nickdunn</author>
            <concepts>
                <item id="33144" handle="field-types" section-handle="concepts" section-name="Concepts">Field Types</item>
                <item id="33073" handle="data-source-filters" section-handle="concepts" section-name="Concepts">Data Source Filters</item>
                <item id="33066" handle="pages" section-handle="concepts" section-name="Concepts">Pages</item>
                <item id="33065" handle="fields" section-handle="concepts" section-name="Concepts">Fields</item>
            </concepts>
            <conclusion mode="formatted"><p>This tutorial has covered in depth how to build simple &#8220;find my nearest&#8221; functionality in the form of a store locator using the Map Location Field in Symphony 2.</p>
<p>We have seen how to install the Map Location Field, how to use its drag/drop and geocoding functionality, how to use data source filtering to search by radius, and how to interact with this data source from a page.</p>
<p>I hope it&#8217;s given you a good idea about the possibilities now available to you, and how you can use this functionality in your own websites.</p></conclusion>
            <date-modified time="16:08" weekday="1">2010-01-04</date-modified>
            <date-published time="16:08" weekday="1">2010-01-04</date-published>
            <introduction mode="formatted"><p>This tutorial will provide a complete walkthrough of how to implement &#8220;find my nearest&#8221; functionality on your website, most commonly used for store locator searches. Since it is a complete tutorial (with full supporting code) this is intermediate level.</p>
<p>Google Maps makes it easier than ever to build a spatial aspect into our websites. For several years now Symphony has had a Map Location field which displays a Google Map in the backend and allows your authors to drop a marker pin onto a specific location. Version 3 of this field released in January 2010 adds some amazing new features which make a &#8220;find my nearest&#8221; search a joy to implement.</p>
<p>By the end of this tutorial you will have:</p>
<ul>
<li>installed the Map Location Field and learned how to use its main functionality</li>
<li>created a Data Source filter to perform a radius search on a given location</li>
<li>built a frontend to allow users to search and sort entries based on their location</li>
</ul>
<p><img src="http://symphony-cms.com/workspace/assets/learn/Screen-shot-2010-01-05-at-10.06.4-1262686039.png" alt="Store Locator" /></p></introduction>
            <summary mode="formatted"><p>An in-depth tutorial on how to implement &#8220;find my nearest&#8221; in Symphony.</p></summary>
            <title handle="building-a-store-locator-using-the-map-location-field">Building a store locator using the Map Location Field</title>
        </entry>
    </learn-tutorial-view>
    <learn-tutorial-resources>
        <section id="64" handle="resources">Resources</section>
        <error>No records found.</error>
    </learn-tutorial-resources>
    <learn-tutorial-step>
        <section id="60" handle="tutorial-steps">Tutorial Steps</section>
        <entry id="36374">
            <description mode="formatted"><p>You&#8217;re ready to view the page!</p>
<pre><code>/store-locator/
</code></pre>
<p>You should see a form into which you can type a radius and postcode. Go ahead. Try entering a place or postcode that is within a radius of one of the entries you created earlier. It appears in the list? Neat! Now try reducing the radius, and eventually it&#8217;ll disappear as your search narrows.</p>
<p>This is all well and good, but not particularly <em>useful</em> since users don&#8217;t know which is nearest to <em>them</em>. Thankfully the Map Location Field also calculates the distance between the map marker in the entry, and the origin you are searching from. Take a peek at the <code>?debug</code> XML again and you&#8217;ll see a <code>&lt;distance&gt;</code> element in each entry:</p>
<pre><code>&lt;location latitude="51.6514" longitude="-0.387649"&gt;
    ...
    &lt;distance from="51.6245572,-0.4674079" distance="6.3" unit="km" /&gt;
&lt;/location&gt;
</code></pre>
<p>We can now enter to distance to each entry beside the name and address. Update the last template in your page to include the <code>distance</code> and <code>unit</code> attributes from the <code>&lt;distance&gt;</code> element:</p>
<pre><code>&lt;li&gt;
    &lt;xsl:value-of select="concat(name, ': ', address)"/&gt; (&lt;xsl:value-of select="concat(location/distance/@distance, ' ' , location/distance/@unit)"/&gt;)
&lt;/li&gt;
</code></pre>
<p>And we can also order the list of entries putting the nearest at the top. Modify the <code>apply-templates</code> in the first template:</p>
<pre><code>&lt;xsl:apply-templates select="store-locator/entry" mode="store"&gt;
    &lt;xsl:sort select="location/distance/@distance" data-type="number" order="ascending"/&gt;
&lt;/xsl:apply-templates&gt;
</code></pre>
<p>You should now see distances beside each entry, and the nearest entry at the top.</p>
<p><a href="http://www.comparethemeerkat.com/home">Simples!</a></p></description>
            <name handle="testing-and-tweaking">Testing and Tweaking</name>
            <resources>
                <item id="36408" handle="tutorial-store-locator-page" section-handle="resources" section-name="Resources">Tutorial: Store Locator page</item>
            </resources>
            <step-number>6</step-number>
        </entry>
    </learn-tutorial-step>
    <learn-tutorial-step-resources>
        <section id="64" handle="resources">Resources</section>
        <type handle="screenshot" value="Screenshot">
            <entry id="36408" tutorials="0" tutorial-steps="1">
                <code mode="formatted" />
                <hide>No</hide>
                <image size="79 KB" path="/assets/learn" type="image/png">
                    <filename>Screen-shot-2010-01-05-at-10.06.4-1262686039.png</filename>
                    <meta creation="2010-01-05T20:07:19+10:00" width="826" height="516" />
                </image>
                <note mode="formatted" />
                <title handle="tutorial-store-locator-page">Tutorial: Store Locator page</title>
                <type>
                    <item handle="screenshot">Screenshot</item>
                </type>
            </entry>
        </type>
    </learn-tutorial-step-resources>
    <learn-tutorial-steps>
        <section id="60" handle="tutorial-steps">Tutorial Steps</section>
        <entry id="36369">
            <name handle="install-the-map-location-field">Install the Map Location Field</name>
            <step-number>1</step-number>
        </entry>
        <entry id="36370">
            <name handle="build-your-section">Build your Section</name>
            <step-number>2</step-number>
        </entry>
        <entry id="36371">
            <name handle="populate-the-data">Populate the data</name>
            <step-number>3</step-number>
        </entry>
        <entry id="36372">
            <name handle="select-entries-with-a-data-source">Select Entries with a Data Source</name>
            <step-number>4</step-number>
        </entry>
        <entry id="36373">
            <name handle="displaying-entries-on-a-page">Displaying Entries on a Page</name>
            <step-number>5</step-number>
        </entry>
        <entry id="36374">
            <name handle="testing-and-tweaking">Testing and Tweaking</name>
            <step-number>6</step-number>
        </entry>
    </learn-tutorial-steps>
</data>